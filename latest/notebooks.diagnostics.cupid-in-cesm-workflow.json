{"version":3,"kind":"Article","sha256":"ea77c2af2c0108f8967932083385e0a16bd9302a1b5e3313664cdf091f49d739","slug":"notebooks.diagnostics.cupid-in-cesm-workflow","location":"/notebooks/diagnostics/CUPiD_in_CESM_Workflow.md","dependencies":[],"frontmatter":{"title":"Running CUPiD within CESM","content_includes_title":false,"github":"https://github.com/CROCODILE-CESM/CrocoGallery","numbering":{"title":{"offset":2}},"source_url":"https://github.com/CROCODILE-CESM/CrocoGallery/blob/main/gallery/notebooks/diagnostics/CUPiD_in_CESM_Workflow.md","edit_url":"https://github.com/CROCODILE-CESM/CrocoGallery/edit/main/gallery/notebooks/diagnostics/CUPiD_in_CESM_Workflow.md","exports":[{"format":"md","filename":"CUPiD_in_CESM_Workflow.md","url":"/CrocoGallery/latest/build/CUPiD_in_CESM_Workfl-99d3321607cd26ba5a801914a12dafe4.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"CUPiD has been included in the CESM workflow,\nwhich means you can run CUPiD from a CESM case directory with the familiar ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yUmltaAQNb"},{"type":"inlineCode","value":"case.submit","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"J99vvNMpYD"},{"type":"text","value":" command.\nFor this project, we will run the notebooks Aidan put together to analyze a case you ran yourself.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dpyetQxne0"}],"key":"vJ9aCWuq3q"},{"type":"heading","depth":2,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Background","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"J3fj1FO4OF"}],"identifier":"background","label":"Background","html_id":"background","implicit":true,"key":"mW808YXDea"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"This notebook originated as a third task in the ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"zDYdOJgin3"},{"type":"link","url":"/notebooks/diagnostics/cupid-for-regional-mom6","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"CUPiD Diagnostics Tutorial","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"NflmPwlmth"}],"urlSource":"CUPiD_for_regional_MOM6","dataUrl":"/notebooks.diagnostics.cupid-for-regional-mom6.json","internal":true,"protocol":"file","key":"HBq8eFG4sB"},{"type":"text","value":".\nIt still uses some of the same structure as the tutorial pages.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"n5gv3tzunn"}],"key":"TvYLh2MuCQ"},{"type":"heading","depth":3,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Step 1: Log on to Derecho and Navigate to your CESM case","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"rtUtTf0efw"}],"identifier":"step-1-log-on-to-derecho-and-navigate-to-your-cesm-case","label":"Step 1: Log on to Derecho and Navigate to your CESM case","html_id":"step-1-log-on-to-derecho-and-navigate-to-your-cesm-case","implicit":true,"key":"L79wIHdXDY"},{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"For the tutorial, we ran CUPiD on NCARâ€™s Casper machine, which is very useful for diagnostics, data analysis, and visualization.\nThe CESM case that we made in Mondayâ€™s practicum, ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"rJoxnaq2O1"},{"type":"strong","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Using CrocoDash","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"lqw02MGMlu"}],"key":"aiLRkD1Juu"},{"type":"text","value":", was set up to run on Derecho.\nCESM is picky about what machine it runs on because it tailors the configuration and run accordingly.\nEven though Derecho and Casper share a file system, they have very different hardware (and provide users with different modules).","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"UbO0ZD0XyK"}],"key":"ILiecEldWK"},{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"You can either log in to Derecho directly from JupyterHub,\nor log in to Casper through the JupyterHub and then ssh to Derecho from a terminal.","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"Nf1h0TIoDt"}],"key":"U1f8AbFRS8"},{"type":"paragraph","position":{"start":{"line":22,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"Once you are on derecho, change into the directory for the case you want to analyze.\nThe path to this directory might vary, but it will likely be located under the same ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"y0EVI8FLpA"},{"type":"inlineCode","value":"crocodile_2025","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"sn5mpMCtXt"},{"type":"text","value":" directory we have been working in so far.","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"OZkTOq5gJn"}],"key":"sUNlQlqzTo"},{"type":"heading","depth":3,"position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"Step 2: Explore how CUPiD is Incorporated in a CESM Case","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"XZgSjeG3IK"}],"identifier":"step-2-explore-how-cupid-is-incorporated-in-a-cesm-case","label":"Step 2: Explore how CUPiD is Incorporated in a CESM Case","html_id":"step-2-explore-how-cupid-is-incorporated-in-a-cesm-case","implicit":true,"key":"iKq6eTCfhm"},{"type":"paragraph","position":{"start":{"line":27,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"As you are likely familiar with at this point,\nCESM uses XML files to manage the environment in which your case is run.\nEach file contains variables pertaining to a different phase of the case generation process:","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"vkArzmtH3w"}],"key":"qA3Tnb7O7v"},{"type":"code","lang":"bash","value":"env_archive.xml\nenv_batch.xml\nenv_build.xml\nenv_case.xml\nenv_mach_pes.xml\nenv_mach_specific.xml\nenv_postprocessing.xml\nenv_run.xml\nenv_workflow.xml","position":{"start":{"line":31,"column":1},"end":{"line":41,"column":1}},"key":"hrcRqlxE0z"},{"type":"paragraph","position":{"start":{"line":43,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"text","value":"We are interested in the CUPiD variables,\nwhich are all defined in ","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"eBP8jO79QT"},{"type":"inlineCode","value":"env_postprocessing.xml","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"imEFhw9LwL"},{"type":"text","value":".\nXML files are plain-text so we can inspect them directly,\nbut weâ€™ll use CIMEâ€™s ","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"M4C1ikkIU1"},{"type":"inlineCode","value":"xmlquery","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"sOUn7YzQCE"},{"type":"text","value":" tool instead.","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"WVrU1ulcsF"}],"key":"hX2iLVeIdm"},{"type":"div","class":"alert alert-warning","children":[{"type":"text","value":"ðŸš¨ ","key":"OuuCMxQTKk"},{"type":"strong","children":[{"type":"text","value":"POP QUIZ!","key":"sVBL7symjF"}],"key":"pYO4G8enY2"},{"type":"text","value":" ðŸš¨","key":"mC18ULTGYj"}],"key":"ezomlqob3S"},{"type":"paragraph","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"children":[{"type":"text","value":"How do you use ","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"hWy9qxhSho"},{"type":"inlineCode","value":"xmlquery","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"WGmwzT11La"},{"type":"text","value":" to see all the variables that contain ","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"niQstznl9x"},{"type":"inlineCode","value":"CUPID","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"qGqoeyd8Vu"},{"type":"text","value":" in their name (along with their values)?","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"u7idJWlLDt"}],"key":"uK0V5h1ZDD"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"Solution","key":"hRmanqJpUk"}],"key":"y4ovym2swV"},{"type":"break","key":"WucZFtCpvO"},{"type":"code","lang":null,"meta":null,"value":"$ ./xmlquery -p CUPID\nResults in group cupid_analysis\n\tCUPID_BASELINE_CASE: b.e23_alpha17f.BLT1850.ne30_t232.092\n\tCUPID_BASELINE_ROOT: /glade/derecho/scratch/mlevy/archive/CAcurrent.002/..\n\tCUPID_BASE_NYEARS: 100\n\tCUPID_BASE_STARTDATE: 0001-01-01\n\tCUPID_EXAMPLE: key_metrics\n\tCUPID_NYEARS: 1\n\tCUPID_STARTDATE: 0001-01-01\n\tCUPID_TS_DIR: /glade/derecho/scratch/mlevy/archive/CAcurrent.002/..\n\nResults in group cupid_config\n\tCUPID_GEN_DIAGNOSTICS: TRUE\n\tCUPID_GEN_HTML: TRUE\n\tCUPID_GEN_TIMESERIES: TRUE\n\tCUPID_ROOT: /glade/work/mlevy/codes/CESM/cesm3_0_alpha07c_CROCO/tools/CUPiD\n\nResults in group cupid_environments\n\tCUPID_ANALYSIS_ENV: cupid-analysis\n\tCUPID_INFRASTRUCTURE_ENV: cupid-infrastructure\n\nResults in group cupid_run_components\n\tCUPID_MEM_PER_TASK: 10\n\tCUPID_NTASKS: 1\n\tCUPID_RUN_ADF: FALSE\n\tCUPID_RUN_ALL: TRUE\n\tCUPID_RUN_ATM: FALSE\n\tCUPID_RUN_GLC: FALSE\n\tCUPID_RUN_ICE: FALSE\n\tCUPID_RUN_LND: FALSE\n\tCUPID_RUN_OCN: FALSE\n\tCUPID_RUN_ROF: FALSE\n\tCUPID_TASKS_PER_NODE: 128","key":"Mv02nRA8lz"}],"key":"rcYCndY4W1"},{"type":"heading","depth":3,"position":{"start":{"line":94,"column":1},"end":{"line":94,"column":1}},"children":[{"type":"text","value":"Step 3: Configure and Run CUPiD","position":{"start":{"line":94,"column":1},"end":{"line":94,"column":1}},"key":"RzxTAfmLaZ"}],"identifier":"step-3-configure-and-run-cupid","label":"Step 3: Configure and Run CUPiD","html_id":"step-3-configure-and-run-cupid","implicit":true,"key":"bmhs7Q3VGQ"},{"type":"paragraph","position":{"start":{"line":96,"column":1},"end":{"line":102,"column":1}},"children":[{"type":"text","value":"The first variable to talk about is ","position":{"start":{"line":96,"column":1},"end":{"line":96,"column":1}},"key":"NN5f3smj7c"},{"type":"inlineCode","value":"CUPID_ROOT","position":{"start":{"line":96,"column":1},"end":{"line":96,"column":1}},"key":"OxL45JE90p"},{"type":"text","value":".\nCUPiD is distributed with CESM in the ","position":{"start":{"line":96,"column":1},"end":{"line":96,"column":1}},"key":"lFGF9E41M8"},{"type":"inlineCode","value":"tools/CUPiD","position":{"start":{"line":96,"column":1},"end":{"line":96,"column":1}},"key":"XSvIbMV4P1"},{"type":"text","value":" subdirectory,\nbut you may wish to use a more recent version of CUPiD.\nThis could be handy if, for example,\nyou are attending a workshop where you took a CUPiD diagnostic and the first exercises were cloning CUPiD,\ninstalling environments from this clone and then running a few examples.\nIn that case, you want to run","position":{"start":{"line":96,"column":1},"end":{"line":96,"column":1}},"key":"ZOeoUomFj6"}],"key":"SUlxWILFHA"},{"type":"code","lang":"bash","value":"./xmlchange CUPID_ROOT=</path/to/CUPiD>","position":{"start":{"line":104,"column":1},"end":{"line":106,"column":1}},"key":"RpvyHbHGKt"},{"type":"paragraph","position":{"start":{"line":108,"column":1},"end":{"line":109,"column":1}},"children":[{"type":"text","value":"We also want to run the ","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"key":"uSMsz9DDOe"},{"type":"inlineCode","value":"regional_ocean","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"key":"Bep2cC16sT"},{"type":"text","value":" example,\nwhich is set by the ","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"key":"fvOiwPoSFB"},{"type":"inlineCode","value":"CUPID_EXAMPLE","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"key":"qlpD2bGDSe"},{"type":"text","value":" variable.","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"key":"effyRxbl4l"}],"key":"tY7NcTp0R6"},{"type":"code","lang":"bash","value":"./xmlchange CUPID_EXAMPLE=regional_ocean","position":{"start":{"line":111,"column":1},"end":{"line":113,"column":1}},"key":"rlHxZlACE7"},{"type":"paragraph","position":{"start":{"line":115,"column":1},"end":{"line":115,"column":1}},"children":[{"type":"text","value":"Lastly, we donâ€™t need to generate time series files or build a webpage","position":{"start":{"line":115,"column":1},"end":{"line":115,"column":1}},"key":"gNhVJvDnYh"}],"key":"y4amY3VbJx"},{"type":"code","lang":"bash","value":"./xmlchange CUPID_GEN_TIMESERIES=FALSE,CUPID_GEN_HTML=FALSE","position":{"start":{"line":117,"column":1},"end":{"line":119,"column":1}},"key":"eq3OwsPTCy"},{"type":"paragraph","position":{"start":{"line":121,"column":1},"end":{"line":122,"column":1}},"children":[{"type":"text","value":"When you are ready to run CUPiD, you can tell ","position":{"start":{"line":121,"column":1},"end":{"line":121,"column":1}},"key":"aZ143GfbAa"},{"type":"inlineCode","value":"case.submit","position":{"start":{"line":121,"column":1},"end":{"line":121,"column":1}},"key":"jMSJnqlFXp"},{"type":"text","value":" that you want to run the ","position":{"start":{"line":121,"column":1},"end":{"line":121,"column":1}},"key":"fD3jiCoYFK"},{"type":"inlineCode","value":"case.cupid","position":{"start":{"line":121,"column":1},"end":{"line":121,"column":1}},"key":"HpK7S6dowS"},{"type":"text","value":" job in the workflow.\nMake sure you are logged in to Derecho (not Casper) and then run:","position":{"start":{"line":121,"column":1},"end":{"line":121,"column":1}},"key":"JoddJpktWW"}],"key":"le8ttgDPsg"},{"type":"code","lang":"bash","value":"./case.submit --job case.cupid","position":{"start":{"line":124,"column":1},"end":{"line":126,"column":1}},"key":"VDHk9siDgs"},{"type":"paragraph","position":{"start":{"line":128,"column":1},"end":{"line":130,"column":1}},"children":[{"type":"text","value":"This will add a job to the development queue on derecho,\nand it hopefully will start running quickly.\nWhen it finishes, output will be in the ","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"key":"Yy9VJi3ZxI"},{"type":"inlineCode","value":"computed_notebooks","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"key":"DcurC3on0f"},{"type":"text","value":" subdirectory of your case directory.","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"key":"gf27zGVl9D"}],"key":"LJeiDMsoiU"},{"type":"heading","depth":2,"position":{"start":{"line":132,"column":1},"end":{"line":132,"column":1}},"children":[{"type":"text","value":"Side Quest: How Does CUPiD Tie in to CESM?","position":{"start":{"line":132,"column":1},"end":{"line":132,"column":1}},"key":"Dv8zRWW72g"}],"identifier":"side-quest-how-does-cupid-tie-in-to-cesm","label":"Side Quest: How Does CUPiD Tie in to CESM?","html_id":"side-quest-how-does-cupid-tie-in-to-cesm","implicit":true,"key":"hbhESHwlEa"},{"type":"paragraph","position":{"start":{"line":134,"column":1},"end":{"line":138,"column":1}},"children":[{"type":"text","value":"The details look complicated, but itâ€™s pretty simple from the userâ€™s perspective\n(weâ€™re going to look at several files to understand what CESM is doing,\nbut in practice you wonâ€™t need to modify any of them if you just want to run CUPiD).\nThe CESM workflow is defined in the ","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"YoC8VTMbFM"},{"type":"link","url":"https://github.com/ESMCI/ccs_config_cesm","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"children":[{"type":"inlineCode","value":"ccs_config_cesm","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"PLxczFLebI"}],"urlSource":"https://github.com/ESMCI/ccs_config_cesm","error":true,"key":"ffaHd1QWPl"},{"type":"text","value":" repository,\nand the piece relevant to CUPiD is the ","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"nOK20b0H8C"},{"type":"link","url":"https://github.com/ESMCI/ccs_config_cesm/blob/main/machines/template.cupid","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"children":[{"type":"inlineCode","value":"machines/template.cupid","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"gSMp7xYFOz"}],"urlSource":"https://github.com/ESMCI/ccs_config_cesm/blob/main/machines/template.cupid","data":{"kind":"file","org":"ESMCI","repo":"ccs_config_cesm","reference":"main","file":"machines/template.cupid","raw":"https://raw.githubusercontent.com/ESMCI/ccs_config_cesm/main/machines/template.cupid"},"internal":false,"protocol":"github","key":"zoRnF6DSs3"},{"type":"text","value":" file:","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"m4D7oxPrD6"}],"key":"nzIuMGxgep"},{"type":"code","lang":"bash","value":"#!/bin/bash -e\n\n# Batch system directives\n{{ batchdirectives }}\n\n# Set environment for CESM\nsource .env_mach_specific.sh\n\n# Run shell script in CUPiD external\nCUPID_ROOT=`./xmlquery --value CUPID_ROOT`\n(. ${CUPID_ROOT}/helper_scripts/cesm_postprocessing.sh)","position":{"start":{"line":140,"column":1},"end":{"line":152,"column":1}},"key":"sftzikPMyD"},{"type":"paragraph","position":{"start":{"line":154,"column":1},"end":{"line":156,"column":1}},"children":[{"type":"text","value":"CIME parses everything in ","position":{"start":{"line":154,"column":1},"end":{"line":154,"column":1}},"key":"a4rU3w8SNp"},{"type":"inlineCode","value":"{{ }}","position":{"start":{"line":154,"column":1},"end":{"line":154,"column":1}},"key":"UtMnfOOXLP"},{"type":"text","value":" and replaces it with machine-specific code;\nthe final file is ","position":{"start":{"line":154,"column":1},"end":{"line":154,"column":1}},"key":"hs00xNJCdE"},{"type":"inlineCode","value":"case.cupid","position":{"start":{"line":154,"column":1},"end":{"line":154,"column":1}},"key":"JJ2JE9WHD5"},{"type":"text","value":" in your case directory.\nOn derecho, this looks like:","position":{"start":{"line":154,"column":1},"end":{"line":154,"column":1}},"key":"hMp3nvtXpT"}],"key":"j8Q00lSe9N"},{"type":"code","lang":"bash","value":"#!/bin/bash -e\n\n# Batch system directives\n#PBS -N cupid.{CASE}\n#PBS  -r n\n#PBS  -j oe\n#PBS  -S /bin/bash\n#PBS  -l select=1:ncpus=1:mpiprocs=1:ompthreads=1:mem=10GB\n\n# Set environment for CESM\nsource .env_mach_specific.sh\n\n# Run shell script in CUPiD external\nCUPID_ROOT=`./xmlquery --value CUPID_ROOT`\n(. ${CUPID_ROOT}/helper_scripts/cesm_postprocessing.sh)","position":{"start":{"line":158,"column":1},"end":{"line":174,"column":1}},"key":"TBlsrcF35L"},{"type":"paragraph","position":{"start":{"line":176,"column":1},"end":{"line":181,"column":1}},"children":[{"type":"text","value":"In an attempt to keep all necessary code in the CUPiD repository,\nyouâ€™ll note that the last two lines are then calling ","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"key":"lczw3Jgv73"},{"type":"link","url":"https://github.com/NCAR/CUPiD/blob/main/helper_scripts/cesm_postprocessing.sh","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"children":[{"type":"inlineCode","value":"helper_scripts/cesm_postprocessing.sh","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"key":"z5nJE5d9xL"}],"urlSource":"https://github.com/NCAR/CUPiD/blob/main/helper_scripts/cesm_postprocessing.sh","data":{"kind":"file","org":"NCAR","repo":"CUPiD","reference":"main","file":"helper_scripts/cesm_postprocessing.sh","raw":"https://raw.githubusercontent.com/NCAR/CUPiD/main/helper_scripts/cesm_postprocessing.sh"},"internal":false,"protocol":"github","key":"slX6QK7Wyb"},{"type":"text","value":" out of ","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"key":"TSzeDyUYhq"},{"type":"inlineCode","value":"CUPID_ROOT","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"key":"IIZQYacVAp"},{"type":"text","value":".\nCUPiDâ€™s ","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"key":"dMbcM6jbQG"},{"type":"link","url":"https://github.com/NCAR/CUPiD/blob/main/helper_scripts/","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"children":[{"type":"inlineCode","value":"helper_scripts/","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"key":"gFtBjrV44l"}],"urlSource":"https://github.com/NCAR/CUPiD/blob/main/helper_scripts/","data":{"kind":"file","org":"NCAR","repo":"CUPiD","reference":"main","file":"helper_scripts/","raw":"https://raw.githubusercontent.com/NCAR/CUPiD/main/helper_scripts/"},"internal":false,"protocol":"github","key":"ihozjyevV2"},{"type":"text","value":" directory contains several scripts used to create configuration files,\nand ","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"key":"cud3NihLE9"},{"type":"inlineCode","value":"cesm_postprocessing.sh","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"key":"TTKn0U9F9X"},{"type":"text","value":" is the driver that ties everything together.\nWe wonâ€™t walk through the entire script here,\nbut I want to highlight the comments in the script that list the processes:","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"key":"vMIRHi4ijb"}],"key":"ixKvllbPbi"},{"type":"code","lang":"bash","value":"# Set variables that come from environment or CESM XML files\n\n# Create directory for running CUPiD\nmkdir -p cupid-postprocessing\ncd cupid-postprocessing\n\n# Use cupid-infrastructure environment for running these scripts\nconda activate ${CUPID_INFRASTRUCTURE_ENV}\n\n# 1. Generate CUPiD config file\n${CUPID_ROOT}/helper_scripts/generate_cupid_config_for_cesm_case.py\n\n# 2. Generate ADF config file\nif [ \"${CUPID_RUN_ADF}\" == \"TRUE\" ]; then\n\n# 3. Generate ILAMB config file\nif [ \"${CUPID_RUN_ILAMB}\" == \"TRUE\" ]; then\n\n# 4. Generate LDF config file\nif [ \"${CUPID_RUN_LDF}\" == \"TRUE\" ]; then\n\n# 5. Generate timeseries files\nif [ \"${CUPID_GEN_TIMESERIES}\" == \"TRUE\" ]; then\n\n# 6. Run ADF\nif [ \"${CUPID_RUN_ADF}\" == \"TRUE\" ]; then\n\n# 7. Run ILAMB\nif [ \"${CUPID_RUN_ILAMB}\" == \"TRUE\" ]; then\n\n# 8. Run LDF\nif [ \"${CUPID_RUN_LDF}\" == \"TRUE\" ]; then\n\n# 9. Run CUPiD and build webpage\nconda deactivate\nconda activate ${CUPID_INFRASTRUCTURE_ENV}\nif [ \"${CUPID_GEN_DIAGNOSTICS}\" == \"TRUE\" ]; then\n  ${CUPID_ROOT}/cupid/run_diagnostics.py ${CUPID_FLAG_STRING}\nfi\nif [ \"${CUPID_GEN_HTML}\" == \"TRUE\" ]; then\n  ${CUPID_ROOT}/cupid/generate_webpage.py\nfi","position":{"start":{"line":183,"column":1},"end":{"line":226,"column":1}},"key":"Qsl7ZtvqSj"},{"type":"paragraph","position":{"start":{"line":228,"column":1},"end":{"line":229,"column":1}},"children":[{"type":"text","value":"You can see how the variables defined in ","position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"key":"fOz7vu2q94"},{"type":"inlineCode","value":"env_postprocessing.xml","position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"key":"jKRfntrZQv"},{"type":"text","value":" impact what parts of CUPiD are run.\nIn the next task we will make sure these XML variables are set correctly and then ask CESM to run ","position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"key":"OnbjfelXim"},{"type":"inlineCode","value":"case.cupid","position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"key":"MMVFYgZ2hA"},{"type":"text","value":".","position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"key":"JDoMitzIJw"}],"key":"QWiljxqf5U"}],"key":"Y2WXr5hSuY"}],"key":"uny58TYGcp"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":" Advanced CUPiD Tutorial ","url":"/notebooks/diagnostics/cupid-projects","group":"Sample CrocoDash Projects"},"next":{"title":"Contributing to CUPiD","url":"/notebooks/diagnostics/contributing-to-cupid","group":"Sample CrocoDash Projects"}}},"domain":"http://localhost:3000"}
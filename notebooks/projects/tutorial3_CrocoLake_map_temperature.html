
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>CrocoLake - Temperature map in the North West Atlantic &#8212; CrocoDash Gallery</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/projects/tutorial3_CrocoLake_map_temperature';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Model-Observation comparison with MOM6 and World Ocean Database" href="tutorial4_MOM6-WOD13-comparison.html" />
    <link rel="prev" title="Tutorial 2: Model-Observation comparison with MOM6 and a single Argo float from CrocoLake" href="tutorial2_MOM6-CL-comparison-float.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/crocodile.png" class="logo__image only-light" alt="CrocoDash Gallery - Home"/>
    <script>document.write(`<img src="../../_static/crocodile.png" class="logo__image only-dark" alt="CrocoDash Gallery - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Welcome to the CrocoDash Gallery!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorials/walkthrough.html">Basic CrocoDash Tutorial</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/cesm_setup.html">CESM Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/minimal_demo_rect.html">Set up a rectangular regional CESM-MOM6 run</a></li>




<li class="toctree-l2"><a class="reference internal" href="../tutorials/input_params.html">Input Parameters</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Feature Tutorials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../features/coupling.html">Coupling Tutorials</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../features/add_bgc.html">Run a coupled biogeochemistry (MARBL) &amp; ocean (MOM6) model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/add_cice.html">Run a coupled sea ice (CICE) &amp; ocean (MOM6) model</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../features/custom_grid.html">Grid Customization Tutorials</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../features/subset_global.html">Add Global Subset Grids</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/add_grids.html">Use Custom Pre-Generated Grids</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../features/data_product.html">Data Product Tutorials</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../features/too_much_data.html">Setup Iterative OBC generation (for Long CESM-MOM6 runs) w/ the  Large Data Workflow (Advanced)</a></li>

<li class="toctree-l2"><a class="reference internal" href="../features/add_data_products.html">Use different data products w/ the CrocoDash Data Access Module</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../features/add_components.html">Additional Component Tutorials</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../features/add_rof.html">Add data runoff from GLOFAS to the Run</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/add_runoff_product.html">Adding your own runoff product to the CESM (Advanced)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/add_chl.html">Add Chlorophyll Files to the Run</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/add_tides.html">Add Boundary Tides to the Run</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">2025 CROCODILE Workshop Projects</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="NWA.html">NWA</a></li>

<li class="toctree-l1"><a class="reference internal" href="CICE.html">CICE-MOM6</a></li>




<li class="toctree-l1"><a class="reference internal" href="choose_your_own_adventure.html">Choose your own adventure!</a></li>




<li class="toctree-l1 current active has-children"><a class="reference internal" href="model-obs_comparison.html">Model-Observation Comparison Tutorials and Projects</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorial1_MOM6-CL-comparison.html">Tutorial 1: Model-Observation comparison with MOM6 and CrocoLake</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial2_MOM6-CL-comparison-float.html">Tutorial 2: Model-Observation comparison with MOM6 and a single Argo float from CrocoLake</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">CrocoLake - Temperature map in the North West Atlantic</a></li>



<li class="toctree-l2"><a class="reference internal" href="tutorial4_MOM6-WOD13-comparison.html">Model-Observation comparison with MOM6 and World Ocean Database</a></li>
<li class="toctree-l2"><a class="reference internal" href="model-obs_your_own_model.html">Model-Observation comparison: use your own MOM6 run</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Use Cases</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../use_cases/index.html">Development Cases</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/three_boundary_from_t232.html">Make a lowres domain for DA dev work!</a></li>




<li class="toctree-l2"><a class="reference internal" href="../use_cases/three_boundary.html">Setup the NWA12 domain through CrocoDash</a></li>




<li class="toctree-l2"><a class="reference internal" href="../use_cases/mom6_cice_antarctica.html">Set up a rectangular regional CESM-MOM6-CICE coupled run</a></li>




</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/CROCODILE-CESM/CrocoGallery/main?urlpath=lab/tree/gallery/notebooks/projects/tutorial3_CrocoLake_map_temperature.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/CROCODILE-CESM/CrocoGallery" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/CROCODILE-CESM/CrocoGallery/issues/new?title=Issue%20on%20page%20%2Fnotebooks/projects/tutorial3_CrocoLake_map_temperature.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/notebooks/projects/tutorial3_CrocoLake_map_temperature.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>CrocoLake - Temperature map in the North West Atlantic</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">CrocoLake - Temperature map in the North West Atlantic</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installing-crocolake">“Installing” CrocoLake</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#note-on-parquet-files">Note on parquet files</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-started">Getting started</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#pyarrow-pandas-approach">pyarrow + pandas approach</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#map">Map</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#dask-approach">dask approach</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Map</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#suggested-exercises">Suggested exercises</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="crocolake-temperature-map-in-the-north-west-atlantic">
<h1>CrocoLake - Temperature map in the North West Atlantic<a class="headerlink" href="#crocolake-temperature-map-in-the-north-west-atlantic" title="Link to this heading">#</a></h1>
<p>This tutorial shows how to read and manipulate CrocoLake data. CrocoLake is stored in parquet format across multiple files for faster reading operations: we will load into memory only what we need by applying some filters, and we will create a map showing the temperature measurements in the North West Atlantic.</p>
<p>CrocoLake contains QCed data from different datasets (Argo, GLODAP, Spray Gliders as of today).</p>
<p>You can find more examples on the <a class="reference external" href="https://github.com/boom-lab/crocolake-python">crocolake-python repository</a>.</p>
<section id="installing-crocolake">
<h2>“Installing” CrocoLake<a class="headerlink" href="#installing-crocolake" title="Link to this heading">#</a></h2>
<p>CrocoLake is not a package but a dataset, thus it does not require any installation per se. To access the data with Python you’ll need the <a class="reference external" href="https://pandas.pydata.org/">pandas</a> and <a class="reference external" href="https://www.dask.org/">dask</a> packages though. If you have installed CrocoCamp in a previous tutorial, you’re already set and you can use the same conda environment you have used before (instructions were provided also <a class="reference external" href="https://github.com/CROCODILE-CESM/CrocoCamp/tree/2025-Crocodile-Workshop">here</a>). If you still have issues, look also at the <a class="reference external" href="https://github.com/boom-lab/crocolake-python">crocolake-python repository</a>, or contact <a class="reference external" href="mailto:enrico&#46;milanese&#37;&#52;&#48;whoi&#46;edu">enrico<span>&#46;</span>milanese<span>&#64;</span>whoi<span>&#46;</span>edu</a>.</p>
<section id="note-on-parquet-files">
<h3>Note on parquet files<a class="headerlink" href="#note-on-parquet-files" title="Link to this heading">#</a></h3>
<p>There are several ways to load parquet files in a dataframe in Python, and this notebook shows two of them:</p>
<ol class="arabic simple">
<li><p>pandas + pyarrow: this approach uses the pyarrow package to load the data into a pandas dataframe;</p></li>
<li><p>dask (+ pandas + pyarrow): this approach uses the dask package to load the data into a dask dataframe; it uses pandas and pyarrow under the hood, and a dask dataframe is (almost) identical to a pandas dataframe.</p></li>
</ol>
<p>We will first use pyarrow to load the dataset, so that we can provide a target schema (containing the Argo variable names) and load the data consistently across floats, independently of what variables each float actually has. We will finally convert the dataset to a pandas dataframe for manipulation and plots.</p>
<p>Other ways to read parquet files are by using pandas (make sure you have pyarrow, fastparquet or some other suitable engine installed), and Dask. Generally speaking, you’ll want to use Dask only if you need a large amount of data at the same time so that you can benefit from its parallelization. You should avoid Dask whenever the data fits in your RAM.</p>
<p>When reading parquet files with pyarrow (or pandas), you can either specificy the file name(s), or the directory containing all the parquet files. In latter case if you apply any filter, pandas and pyarrow will sort through all the files in the folder, reading into memory only the subsets that satisfy your filter.</p>
</section>
</section>
<section id="getting-started">
<h2>Getting started<a class="headerlink" href="#getting-started" title="Link to this heading">#</a></h2>
<p>We then import the necessary modules and set up the path to the dataset (update the <code class="docutils literal notranslate"><span class="pre">crocolake_path</span></code> variable below if you stored CrocoLake at a different location).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pprint</span><span class="w"> </span><span class="kn">import</span> <span class="n">pprint</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyarrow.parquet</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pq</span>

<span class="c1"># Path to CrocoLake PHY</span>
<span class="n">crocolake_path</span> <span class="o">=</span> <span class="s1">&#39;/glade/campaign/cgd/oce/projects/CROCODILE/workshops/2025/CrocoCamp/CrocoLakePHY/&#39;</span>

<span class="c1"># Setting up parquet schema</span>
<span class="n">crocolake_schema</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">read_schema</span><span class="p">(</span><span class="n">crocolake_path</span><span class="o">+</span><span class="s2">&quot;_common_metadata&quot;</span><span class="p">)</span>

<span class="c1"># Geographical boundaries</span>
<span class="n">lat0</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">lat1</span> <span class="o">=</span> <span class="mi">45</span>
<span class="n">lon0</span> <span class="o">=</span> <span class="o">-</span><span class="mi">85</span>
<span class="n">lon1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">60</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="pyarrow-pandas-approach">
<h1>pyarrow + pandas approach<a class="headerlink" href="#pyarrow-pandas-approach" title="Link to this heading">#</a></h1>
<p>We now create a <code class="docutils literal notranslate"><span class="pre">ParquetDataset</span></code> object that will allow us to read the data. Specifying a schema (that we read into <code class="docutils literal notranslate"><span class="pre">crocolake_schema</span></code> in the previous cell) will make later operations faster.</p>
<p>We can get a peak at what variables are available in the dataset looking at its <code class="docutils literal notranslate"><span class="pre">schema</span></code> attribute. Note that we have not load any data into memory yet (except for the schema).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">ParquetDataset</span><span class="p">(</span>
    <span class="n">crocolake_path</span><span class="p">,</span> 
    <span class="n">schema</span><span class="o">=</span><span class="n">crocolake_schema</span>
<span class="p">)</span>
<span class="n">schema</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">schema</span>
<span class="n">pprint</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">schema</span><span class="o">.</span><span class="n">names</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>We now want to filter the dataset to load in memory only the data from the NWA (we set the values for <code class="docutils literal notranslate"><span class="pre">lat0</span></code>,<code class="docutils literal notranslate"><span class="pre">lat1</span></code>,<code class="docutils literal notranslate"><span class="pre">lon0</span></code>,<code class="docutils literal notranslate"><span class="pre">lon1</span></code> in the first cell) and recorded in the last 6 months.</p>
<p>The geographical coordinates are stored in the variables ‘LATITUDE’and ‘LONGITUDE’. We then generate the filter, with its syntax being: <code class="docutils literal notranslate"><span class="pre">[[(column,</span> <span class="pre">op,</span> <span class="pre">val),</span> <span class="pre">…],…]</span></code> where <code class="docutils literal notranslate"><span class="pre">column</span></code> is the variable name, and <code class="docutils literal notranslate"><span class="pre">val</span></code> is the value to for the operator <code class="docutils literal notranslate"><span class="pre">op</span></code>, which accepts <code class="docutils literal notranslate"><span class="pre">[==,</span> <span class="pre">=,</span> <span class="pre">&gt;,</span> <span class="pre">&gt;=,</span> <span class="pre">&lt;,</span> <span class="pre">&lt;=,</span> <span class="pre">!=,</span> <span class="pre">in,</span> <span class="pre">not</span> <span class="pre">in]</span></code>,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">date0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">date1</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">filter_coords_time</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;LATITUDE&quot;</span><span class="p">,</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span><span class="n">lat0</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;LATITUDE&quot;</span><span class="p">,</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span><span class="n">lat1</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;LONGITUDE&quot;</span><span class="p">,</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span><span class="n">lon0</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;LONGITUDE&quot;</span><span class="p">,</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span><span class="n">lon1</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;JULD&quot;</span><span class="p">,</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span><span class="n">date0</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;JULD&quot;</span><span class="p">,</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span><span class="n">date1</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>To get a pandas dataframe, we re-generate a <code class="docutils literal notranslate"><span class="pre">ParquetDataset</span></code> object adding the filters to it, and then we read it into a pandas dataframe with the <code class="docutils literal notranslate"><span class="pre">read().to_pandas()</span></code> methods of the dataset.</p>
<p><em>NB:</em> The following operation fetches a large amount of data (~1.6 GB), so you can reduce the number of days in the filter above if you cannot use this much memory.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">ParquetDataset</span><span class="p">(</span><span class="n">crocolake_path</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">crocolake_schema</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="n">filter_coords_time</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<p>You can explore the dataframe just by calling it (<code class="docutils literal notranslate"><span class="pre">df</span></code>) as we did above. If you want a list of the variables that are stored, you can use <code class="docutils literal notranslate"><span class="pre">sorted(df.columns.to_list())</span></code>. The following cell shows that we loaded roughly 2 GB of data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">memory_usage</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DataFrame size: </span><span class="si">{</span><span class="n">memory_usage</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>If we now that we only need a subset of variables, we can specify them in the dataset’s <code class="docutils literal notranslate"><span class="pre">read()</span></code> method.</p>
<p>For example, let’s say that we are interested in the adjusted measurements of the dissolved oxygen recorded in the past 6 months in the NWA. To exclude non valid and missing observations, we filter the temperature (TEMP) to be within a (large) range of valid values. Besides the oxygen, we also want to keep the spatial and time coordinates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;DB_NAME&quot;</span><span class="p">,</span><span class="s2">&quot;LATITUDE&quot;</span><span class="p">,</span><span class="s2">&quot;LONGITUDE&quot;</span><span class="p">,</span><span class="s2">&quot;PRES&quot;</span><span class="p">,</span><span class="s2">&quot;JULD&quot;</span><span class="p">,</span><span class="s2">&quot;TEMP&quot;</span><span class="p">]</span>
<span class="n">filter_coords_time_temp</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;LATITUDE&quot;</span><span class="p">,</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span><span class="n">lat0</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;LATITUDE&quot;</span><span class="p">,</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span><span class="n">lat1</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;LONGITUDE&quot;</span><span class="p">,</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span><span class="n">lon0</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;LONGITUDE&quot;</span><span class="p">,</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span><span class="n">lon1</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;JULD&quot;</span><span class="p">,</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span><span class="n">date0</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;JULD&quot;</span><span class="p">,</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span><span class="n">date1</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;TEMP&quot;</span><span class="p">,</span><span class="s2">&quot;&gt;=&quot;</span><span class="p">,</span><span class="o">-</span><span class="mf">1e30</span><span class="p">),(</span><span class="s2">&quot;TEMP&quot;</span><span class="p">,</span><span class="s2">&quot;&lt;=&quot;</span><span class="p">,</span><span class="o">+</span><span class="mf">1e30</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">ParquetDataset</span><span class="p">(</span><span class="n">crocolake_path</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">crocolake_schema</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="n">filter_coords_time_temp</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<p>This operation was much faster (3-4x faster on my machine) and loaded a smaller dataframe (~800 MB):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">memory_usage</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DataFrame size: </span><span class="si">{</span><span class="n">memory_usage</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="map">
<h2>Map<a class="headerlink" href="#map" title="Link to this heading">#</a></h2>
<p>We can now produce a scatter plot as we’d normally do with pandas. For example, here is the average dissolved oxygen at each location in the dataframe that we loaded:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">cartopy.crs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ccrs</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">colormaps</span>

<span class="n">ref_var</span> <span class="o">=</span> <span class="s2">&quot;TEMP&quot;</span>
<span class="c1"># Group by &#39;LATITUDE&#39; and &#39;LONGITUDE&#39; and database</span>
<span class="n">df_for_map</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;LATITUDE&quot;</span><span class="p">,</span> <span class="s2">&quot;LONGITUDE&quot;</span><span class="p">,</span> <span class="s2">&quot;DB_NAME&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span>
    <span class="n">ref_var</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span>  <span class="c1"># Take the mean intensity at that coordinate</span>
<span class="p">})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Plotting using Cartopy</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
<span class="n">cbar_min</span> <span class="o">=</span> <span class="n">df_for_map</span><span class="p">[</span><span class="n">ref_var</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">cbar_max</span> <span class="o">=</span> <span class="n">df_for_map</span><span class="p">[</span><span class="n">ref_var</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>

<span class="c1"># Group by DB_NAME and plot each group</span>
<span class="n">df_for_map</span><span class="p">[</span><span class="s2">&quot;DB_NAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">df_for_map</span><span class="p">[</span><span class="s2">&quot;DB_NAME&quot;</span><span class="p">],</span> <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ARGO&quot;</span><span class="p">,</span><span class="s2">&quot;GLODAP&quot;</span><span class="p">,</span><span class="s2">&quot;SprayGliders&quot;</span><span class="p">],</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">cmaps</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span> <span class="p">[</span><span class="s2">&quot;Greens&quot;</span><span class="p">,</span><span class="s2">&quot;Oranges&quot;</span><span class="p">,</span><span class="s2">&quot;Blues&quot;</span><span class="p">]</span> <span class="p">)</span>
<span class="k">for</span> <span class="n">db_name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">df_for_map</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;DB_NAME&quot;</span><span class="p">,</span><span class="n">observed</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">group</span><span class="p">[</span><span class="s1">&#39;LONGITUDE&#39;</span><span class="p">],</span>
        <span class="n">group</span><span class="p">[</span><span class="s1">&#39;LATITUDE&#39;</span><span class="p">],</span>
        <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">c</span><span class="o">=</span><span class="n">group</span><span class="p">[</span><span class="n">ref_var</span><span class="p">],</span>
        <span class="n">vmin</span><span class="o">=</span><span class="n">cbar_min</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="n">cbar_max</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">cmaps</span><span class="p">),</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">shrink</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Average &#39;</span> <span class="o">+</span> <span class="n">ref_var</span> <span class="o">+</span> <span class="s2">&quot; (&quot;</span> <span class="o">+</span> <span class="n">db_name</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;North-West Atlantic average temperature 2010-2019 (Celsius)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">lon0</span><span class="p">,</span> <span class="n">lon1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="n">lat0</span><span class="p">,</span> <span class="n">lat1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="dask-approach">
<h1>dask approach<a class="headerlink" href="#dask-approach" title="Link to this heading">#</a></h1>
<p>dask can be faster at reading parquet databases thanks to its parallel and lazy evaluation of operations.</p>
<p>When using dask, very few things change compared to using pandas and pyarrow: for example, dask dataframes are almost identical to pandas dataframes and indeed for our needs we will use the same syntax! The only difference is that dask does not evaluate the instructions immediately: it creates so-called delayed objects, through which it builds internally a graph of instructions optimized for the sequence of operations called. To trigger the actual computation we then need to call the <code class="docutils literal notranslate"><span class="pre">compute()</span></code> method of the dask dataframe. This allows dask to handle larger-than-memory datasets, by reading into memory only the portions needed to perform the optimized set of instructions.</p>
<p>We start by importing a few extra modules.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">dask</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">dask.dataframe</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">dd</span>
</pre></div>
</div>
</div>
</div>
<p>We can use the same filters defined earlier, and we use <code class="docutils literal notranslate"><span class="pre">read_parquet()</span></code> to filter the database and prescribe what we will need.
Note that:</p>
<ul class="simple">
<li><p>unlike the pyarrow-pandas approach, here we provide both filters and columns in the same method;</p></li>
<li><p>we provide the schema <code class="docutils literal notranslate"><span class="pre">crocolake_schema</span></code> that we read during the set up of the excercise</p></li>
<li><p>dask uses pyarrow under the hood (<code class="docutils literal notranslate"><span class="pre">engine</span></code> variable, other options are available)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">date0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">date1</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;DB_NAME&quot;</span><span class="p">,</span><span class="s2">&quot;LATITUDE&quot;</span><span class="p">,</span><span class="s2">&quot;LONGITUDE&quot;</span><span class="p">,</span><span class="s2">&quot;PRES&quot;</span><span class="p">,</span><span class="s2">&quot;JULD&quot;</span><span class="p">,</span><span class="s2">&quot;TEMP&quot;</span><span class="p">]</span>
<span class="n">filter_coords_time_temp</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;LATITUDE&quot;</span><span class="p">,</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span><span class="n">lat0</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;LATITUDE&quot;</span><span class="p">,</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span><span class="n">lat1</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;LONGITUDE&quot;</span><span class="p">,</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span><span class="n">lon0</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;LONGITUDE&quot;</span><span class="p">,</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span><span class="n">lon1</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;JULD&quot;</span><span class="p">,</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span><span class="n">date0</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;JULD&quot;</span><span class="p">,</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span><span class="n">date1</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;TEMP&quot;</span><span class="p">,</span><span class="s2">&quot;&gt;=&quot;</span><span class="p">,</span><span class="o">-</span><span class="mf">1e30</span><span class="p">),(</span><span class="s2">&quot;TEMP&quot;</span><span class="p">,</span><span class="s2">&quot;&lt;=&quot;</span><span class="p">,</span><span class="o">+</span><span class="mf">1e30</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">ddf</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span>
    <span class="n">crocolake_path</span><span class="p">,</span>
    <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;pyarrow&quot;</span><span class="p">,</span>
    <span class="n">schema</span><span class="o">=</span><span class="n">crocolake_schema</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span> <span class="n">cols</span><span class="p">,</span>
    <span class="n">filters</span><span class="o">=</span><span class="n">filter_coords_time_temp</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>It appears dask is much faster! Yet, it actually creates a delayed object, i.e. <code class="docutils literal notranslate"><span class="pre">ddf</span></code> contains the instructions that dask will later use to load the dataframe into memory. This allows us to use <code class="docutils literal notranslate"><span class="pre">ddf</span></code> to schedule all the operations that we’d normally perform on a dataframe. Eventually we will call <code class="docutils literal notranslate"><span class="pre">ddf.compute()</span></code> to actually evaluate the instructions.</p>
<p>If we look at <code class="docutils literal notranslate"><span class="pre">ddf</span></code>, the dataframe will in fact appear empty:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ddf</span>
</pre></div>
</div>
</div>
</div>
<p>We can explore its first entries with <code class="docutils literal notranslate"><span class="pre">head()</span></code>, which loads into memory only the first 5 entries:</p>
<p>(Note: <code class="docutils literal notranslate"><span class="pre">head()</span></code> can return an empty dataframe even when <code class="docutils literal notranslate"><span class="pre">ddf</span></code> is not empty. This happens because <code class="docutils literal notranslate"><span class="pre">head()</span></code> looks for the first 5 rows of the first partition, which sometimes happens to be empty. Repartitioning the dask dataframe will get rid of empty partitions and solve this.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#ddf=ddf.repartition(partition_size=&quot;300MB&quot;)</span>
<span class="n">ddf</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>To load the whole dataframe, we call <code class="docutils literal notranslate"><span class="pre">compute()</span></code> (this returns a pandas dataframe).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">ddf_loaded</span> <span class="o">=</span> <span class="n">ddf</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="n">ddf_loaded</span>
</pre></div>
</div>
</div>
</div>
<p>It took just a few hundreds milliseconds! So yes, dask can be much faster than just using pyarrow and pandas.</p>
<p>If we look into <code class="docutils literal notranslate"><span class="pre">ddf_loaded</span></code> now, it will show the populated pandas dataframe.</p>
<p>(Note: if you compare <code class="docutils literal notranslate"><span class="pre">ddf_loaded</span></code> with <code class="docutils literal notranslate"><span class="pre">df</span></code> loaded with pyarrow, you’ll see that the rows are not in the same order, yet under the dataframe you can see that the total number of rows is the same. Also the index seems smaller, but dask holds the dataframe in multiple partitions, and the index is reset at every partition.)</p>
<p>dask’s main advantage is not just in loading the data faster, but in performing operations on larger-than-memory data. For example, it can compute the mean value of TEMPERATURE <em>in the whole Argo PHY dataset</em> without loading the whole data in memory (and pretty quickly, too):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># note that we are not passing any filter conditions or selection of columns to load</span>
<span class="n">ddf_all</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span>
    <span class="n">crocolake_path</span><span class="p">,</span>
    <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;pyarrow&quot;</span><span class="p">,</span>
    <span class="n">schema</span><span class="o">=</span><span class="n">crocolake_schema</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">temp_mean</span> <span class="o">=</span> <span class="n">ddf_all</span><span class="p">[</span><span class="s1">&#39;TEMP&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="c1"># temp_mean is a delayed object: it knows what operations to perform to compute the mean, </span>
                                   <span class="c1"># but doesn&#39;t perform them until we call compute() in the next cell</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">temp_mean</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="id1">
<h2>Map<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<p>When producing the map with our dask approach, we would create the <code class="docutils literal notranslate"><span class="pre">grouped</span></code> dataframe from the delayed dataframe <code class="docutils literal notranslate"><span class="pre">ddf</span></code>, and <code class="docutils literal notranslate"><span class="pre">compute()</span></code> it as late as possible.</p>
<p>In this example, the compute that we are triggering includes four operations:</p>
<ul class="simple">
<li><p>reading the filtered dataset;</p></li>
<li><p>grouping the dataframe by geographical coordinates;</p></li>
<li><p>averaging by pressure and time;</p></li>
<li><p>resetting the index;</p></li>
</ul>
<p>Dask internally builds a graph of all of these operations, so that it knows what subset of data is needed and it optimizes the number and sequence of instructions before executing them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">cartopy.crs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ccrs</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">colormaps</span>

<span class="n">ref_var</span> <span class="o">=</span> <span class="s2">&quot;TEMP&quot;</span>
<span class="c1"># Group by &#39;LATITUDE&#39; and &#39;LONGITUDE&#39; and database</span>
<span class="n">ddf_for_map</span> <span class="o">=</span> <span class="n">ddf</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;LATITUDE&quot;</span><span class="p">,</span> <span class="s2">&quot;LONGITUDE&quot;</span><span class="p">,</span> <span class="s2">&quot;DB_NAME&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span>
    <span class="n">ref_var</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span>  <span class="c1"># Take the mean intensity at that coordinate</span>
<span class="p">})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Plotting using Cartopy</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
<span class="n">cbar_min</span> <span class="o">=</span> <span class="n">ddf_for_map</span><span class="p">[</span><span class="n">ref_var</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="n">cbar_max</span> <span class="o">=</span> <span class="n">ddf_for_map</span><span class="p">[</span><span class="n">ref_var</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>

<span class="c1"># Group by DB_NAME and plot each group</span>
<span class="n">ddf</span><span class="p">[</span><span class="s1">&#39;DB_NAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ddf</span><span class="o">.</span><span class="n">DB_NAME</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>

<span class="n">cmaps</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span> <span class="p">[</span><span class="s2">&quot;Greens&quot;</span><span class="p">,</span><span class="s2">&quot;Oranges&quot;</span><span class="p">,</span><span class="s2">&quot;Blues&quot;</span><span class="p">]</span> <span class="p">)</span>
<span class="k">for</span> <span class="n">db_name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">ddf_for_map</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;DB_NAME&quot;</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">group</span><span class="p">[</span><span class="s1">&#39;LONGITUDE&#39;</span><span class="p">],</span>
        <span class="n">group</span><span class="p">[</span><span class="s1">&#39;LATITUDE&#39;</span><span class="p">],</span>
        <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">c</span><span class="o">=</span><span class="n">group</span><span class="p">[</span><span class="n">ref_var</span><span class="p">],</span>
        <span class="n">vmin</span><span class="o">=</span><span class="n">cbar_min</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="n">cbar_max</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">cmaps</span><span class="p">),</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">shrink</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Average &#39;</span> <span class="o">+</span> <span class="n">ref_var</span> <span class="o">+</span> <span class="s2">&quot; (&quot;</span> <span class="o">+</span> <span class="n">db_name</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;North-West Atlantic average temperature 2010-2019 (Celsius)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">lon0</span><span class="p">,</span> <span class="n">lon1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="n">lat0</span><span class="p">,</span> <span class="n">lat1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="suggested-exercises">
<h1>Suggested exercises<a class="headerlink" href="#suggested-exercises" title="Link to this heading">#</a></h1>
<p>Try and access some other data, for example:</p>
<ul class="simple">
<li><p>filtering by different time periods;</p></li>
<li><p>mapping a different parameter;</p></li>
<li><p>restraining the data of interest further by imposing the pressure PRES to be below 100db;</p></li>
<li><p>performing reads/manipulations that you would need to perform your tasks.</p></li>
</ul>
<p>If you encounter any issues, please <a class="reference internal" href="#enrico.milanese&#64;whoi.edu"><span class="xref myst">reach out</span></a>!</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "conda-env-my-crococamp-2025-py"
        },
        kernelOptions: {
            name: "conda-env-my-crococamp-2025-py",
            path: "./notebooks/projects"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'conda-env-my-crococamp-2025-py'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="tutorial2_MOM6-CL-comparison-float.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Tutorial 2: Model-Observation comparison with MOM6 and a single Argo float from CrocoLake</p>
      </div>
    </a>
    <a class="right-next"
       href="tutorial4_MOM6-WOD13-comparison.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Model-Observation comparison with MOM6 and World Ocean Database</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">CrocoLake - Temperature map in the North West Atlantic</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installing-crocolake">“Installing” CrocoLake</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#note-on-parquet-files">Note on parquet files</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-started">Getting started</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#pyarrow-pandas-approach">pyarrow + pandas approach</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#map">Map</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#dask-approach">dask approach</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Map</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#suggested-exercises">Suggested exercises</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By CROCODILE-CESM
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>
{"version":3,"kind":"Notebook","sha256":"8ed25378ca35dc0fd4da6732b97425cc2f340905082aefa27da7ae383fecb74f","slug":"notebooks.features.add-runoff-product","location":"/notebooks/features/add_runoff_product.ipynb","dependencies":[],"frontmatter":{"title":"Adding your own runoff product to the CESM (Advanced)","content_includes_title":false,"github":"https://github.com/CROCODILE-CESM/CrocoGallery","numbering":{"title":{"offset":3}},"source_url":"https://github.com/CROCODILE-CESM/CrocoGallery/blob/HEAD/gallery/notebooks/features/add_runoff_product.ipynb","edit_url":"https://github.com/CROCODILE-CESM/CrocoGallery/edit/HEAD/gallery/notebooks/features/add_runoff_product.ipynb","exports":[{"format":"ipynb","filename":"add_runoff_product.ipynb","url":"/CrocoGallery/pr-28/build/add_runoff_product-e4a8af88dbaaa9d196ac2d2fe61c76eb.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"To add your own runoff product to the CESM, you need three things. A Stream Definition File, an ESMF Mesh file, and the dimensions of your raw data.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"O11S7LYWrJ"}],"key":"v5DzJYuE9U"}],"key":"ADTDGW5T4A"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"ESMF Mesh File","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZYH5Hqrtiv"}],"identifier":"esmf-mesh-file","label":"ESMF Mesh File","html_id":"esmf-mesh-file","implicit":true,"key":"aHAoMyhCW5"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"An ESMF Mesh File can be created like below, using CrocoDash Grids.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"LatwhYoqGt"}],"key":"rSwto13uGp"}],"key":"jGHjUKp3Th"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from CrocoDash.grid import Grid\nfrom CrocoDash.topo import Topo\nimport xarray as xr\n\ngrid = Grid(\n    lenx=360,\n    leny       = 150,         # grid length in y direction\n    cyclic_x=True   ,    \n    ystart     = -60,       # start/end 10 degrees above/below poles to avoid singularity\n    resolution = 0.10,\n    name = \"GLOFAS\",\n)\ntopo = Topo(grid, min_depth = 0)\ntopo.set_flat(10)\ntopo.write_esmf_mesh(\"<path>\")","key":"kTf5kT5qiT"},{"type":"outputs","id":"5OsTlTsUdDI6W1NxwGdJA","children":[],"key":"WYT6DxKssL"}],"key":"zzxQF46FOx"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Stream Definition File","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"owntwXAl2D"}],"identifier":"stream-definition-file","label":"Stream Definition File","html_id":"stream-definition-file","implicit":true,"key":"pEO7lSb3ao"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In your case directory, copy the following file and name it ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mgprhOG5GG"},{"type":"inlineCode","value":"drof.streams.xml","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pw4Izfdagd"},{"type":"text","value":":","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BDaXGUD4az"}],"key":"SoPrUSPXiK"},{"type":"code","lang":"xml","value":"<?xml version=\"1.0\"?>\n<file id=\"stream\" version=\"2.0\">\n\n  <stream_info name=\"rof.<PRODUCT_NAME>\">\n    <taxmode>cycle</taxmode>\n    <tintalgo>upper</tintalgo>\n    <readmode>single</readmode>\n    <mapalgo>bilinear</mapalgo>\n    <dtlimit>3.0</dtlimit>\n    <year_first>\"START_YEAR\"</year_first>\n    <year_last>\"END_YEAR\"</year_last>\n    <year_align>\"START_YEAR\"</year_align>\n    <vectors>null</vectors>\n    <meshfile>\"PATH_TO_THE_PREVIOUSLY_GENERATED_ESMF_MESH_FILE\"</meshfile>\n    <lev_dimname>null</lev_dimname>\n    <datafiles>\n      <file>\"PATH_TO_RAW_DATA_FILE_IN_NETCDF3_64BIT_OFFSET\"</file>\n    </datafiles>\n    <datavars>\n      <var>\"NETCDF_VARIABLE_NAME_IN_FILE\" Forr_rofl</var>\n    </datavars>\n    <offset>0</offset>\n  </stream_info>\n\n</file>","position":{"start":{"line":5,"column":1},"end":{"line":31,"column":1}},"key":"g9XQAYeMsC"},{"type":"heading","depth":3,"position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"Additional Notes","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"F9lskp4slJ"}],"identifier":"additional-notes","label":"Additional Notes","html_id":"additional-notes","implicit":true,"key":"y2XiArW8Kh"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":35,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":35,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Update the CESM ","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"V7ebwKRzyi"},{"type":"inlineCode","value":"components/cdeps/drof","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"AVf50gVe9V"},{"type":"text","value":" directory.","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"cf5VDq7yNs"},{"type":"break","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"USvLQBna2A"},{"type":"text","value":"The following entry should already exist in ","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"YqZFuPmYKT"},{"type":"inlineCode","value":"namelist_definition_drof.xml","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"yqbCJeyNma"},{"type":"text","value":":","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"VcWbwjc4b0"}],"key":"w0p4G4Ujj6"}],"key":"WuANymEjRw"}],"key":"cqZG7d5TpP"},{"type":"code","lang":"xml","value":"<value drof_mode=\"<PRODUCT_NAME>\">rof.<PRODUCT_NAME></value>","position":{"start":{"line":38,"column":1},"end":{"line":40,"column":1}},"key":"KOxLhyngXS"},{"type":"list","ordered":true,"start":2,"spread":false,"position":{"start":{"line":42,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":42,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Update ","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"NpKZ08EFmW"},{"type":"inlineCode","value":"config_component","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"nXaVEHthAO"},{"type":"text","value":" with the new ","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"dGTdZANfoh"},{"type":"inlineCode","value":"<PRODUCT_NAME>","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"PtVZ2wNyEs"},{"type":"text","value":":","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"DpKg9cZqa5"}],"key":"AJ2hWIrbvP"}],"key":"BVjDHhOhx2"}],"key":"ZzhE2EXePx"},{"type":"code","lang":"xml","value":"<desc rof=\"DROF[%NULL][%NYF][%<PRODUCT_NAME>]...\">","position":{"start":{"line":44,"column":1},"end":{"line":46,"column":1}},"key":"EpyguMEpHY"},{"type":"paragraph","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"children":[{"type":"text","value":"Make sure to replace placeholders (","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"j3fyfRvMYm"},{"type":"inlineCode","value":"<PRODUCT_NAME>","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"SuEQwevhwd"},{"type":"text","value":", ","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"JHUmUI7wj0"},{"type":"inlineCode","value":"START_YEAR","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"Xv8N9SfVgk"},{"type":"text","value":", ","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"VpjMeTX7uP"},{"type":"inlineCode","value":"END_YEAR","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"wFztkDBW7d"},{"type":"text","value":", file paths, and variable names) with your actual values.","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"Vk48oQ0OCG"}],"key":"aP2ZqfU9gT"}],"key":"O544dVuOsv"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Add the dimensions","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WD4W7mSX76"}],"identifier":"add-the-dimensions","label":"Add the dimensions","html_id":"add-the-dimensions","implicit":true,"key":"KeTuoh2cZe"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Make the following xml changes in your case directory:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"iAS4ddqtmN"}],"key":"dSdOIAyGkR"},{"type":"code","lang":"","value":"./xmlchange ROF_NY=1500\n\n./xmlchange ROF_NX=3600\n\n./xmlchange ROF_DOMAIN_MESH=<MESH PATH>","position":{"start":{"line":4,"column":1},"end":{"line":10,"column":1}},"key":"z7E2oU0Xu7"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"There may be a few additional changes in the CESM, but this covers a majority of them.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"NIBDbRxyKK"}],"key":"cRGEFJjBvz"}],"key":"AaYnULPr0d"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Then, you can add the mapping files generated through CrocoDash to your case (which requires a passed in ESMF mesh file)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PmfSHOQSra"}],"key":"tSjdbefjae"}],"key":"Bz7bLhmxd1"}],"key":"iJLg0dCyO2"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Add data runoff from GLOFAS or JRA to the Run","url":"/notebooks/features/add-rof","group":"Additional Component Tutorials"},"next":{"title":"Add Chlorophyll Files to the Run","url":"/notebooks/features/add-chl","group":"Additional Component Tutorials"}}},"domain":"http://localhost:3000"}
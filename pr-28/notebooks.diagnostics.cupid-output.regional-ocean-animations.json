{"version":3,"kind":"Notebook","sha256":"c16db252e26b3634d6e2010794d871bfc9fef516a3cf577848ca77612065b411","slug":"notebooks.diagnostics.cupid-output.regional-ocean-animations","location":"/notebooks/diagnostics/cupid_output/Regional_Ocean_Animations.ipynb","dependencies":[],"frontmatter":{"title":"Regional Ocean: Animations of Surface Fields","content_includes_title":true,"kernelspec":{"name":"cupid-analysis","display_name":"cupid-analysis","language":"python"},"github":"https://github.com/CROCODILE-CESM/CrocoGallery","numbering":{"title":{"offset":3}},"source_url":"https://github.com/CROCODILE-CESM/CrocoGallery/blob/HEAD/gallery/notebooks/diagnostics/cupid_output/Regional_Ocean_Animations.ipynb","edit_url":"https://github.com/CROCODILE-CESM/CrocoGallery/edit/HEAD/gallery/notebooks/diagnostics/cupid_output/Regional_Ocean_Animations.ipynb","exports":[{"format":"ipynb","filename":"Regional_Ocean_Animations.ipynb","url":"/CrocoGallery/pr-28/build/Regional_Ocean_Anima-62415ef38510138cceb7412e9ed5c3c2.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.004591,"end_time":"2025-10-13T13:49:40.915801","exception":false,"start_time":"2025-10-13T13:49:40.911210","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Regional Ocean: Animations of Surface Fields","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"stEsXkeK6K"}],"identifier":"regional-ocean-animations-of-surface-fields","label":"Regional Ocean: Animations of Surface Fields","html_id":"regional-ocean-animations-of-surface-fields","implicit":true,"key":"cFQ82NgESW"}],"visibility":"show","key":"YzupJEhM3r"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-10-13T13:49:40.921291Z","iopub.status.busy":"2025-10-13T13:49:40.921108Z","iopub.status.idle":"2025-10-13T13:49:45.289851Z","shell.execute_reply":"2025-10-13T13:49:45.289495Z"},"papermill":{"duration":4.373433,"end_time":"2025-10-13T13:49:45.290758","exception":false,"start_time":"2025-10-13T13:49:40.917325","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"%load_ext autoreload\n%autoreload 2\nimport xarray as xr\nimport os\nfrom IPython.display import HTML\n\nimport regional_utils as utils","visibility":"hide","key":"TXqyJtNkvB"},{"type":"outputs","id":"rwTCRGMdq-aJIlEWp1ENg","children":[],"visibility":"show","key":"LIhQh5Xp2b"}],"visibility":"show","key":"mnMsKmhBQ8"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-10-13T13:49:45.297419Z","iopub.status.busy":"2025-10-13T13:49:45.296825Z","iopub.status.idle":"2025-10-13T13:49:45.345472Z","shell.execute_reply":"2025-10-13T13:49:45.345030Z"},"papermill":{"duration":0.051853,"end_time":"2025-10-13T13:49:45.346598","exception":false,"start_time":"2025-10-13T13:49:45.294745","status":"completed"},"tags":["parameters"]},"children":[{"type":"code","lang":"python","executable":true,"value":"case_name = \"\"  # \"/glade/campaign/cgd/oce/projects/CROCODILE/workshops/2025/Diagnostics/CESM_Output/\"\nCESM_output_dir = \"\"  # \"CROCODILE_tutorial_nwa12_MARBL\"\n\n# As regional domains vary so much in purpose, simulation length, and extent, we don't want to assume a minimum duration\n## Thus, we ignore start and end dates and simply reduce/output over the whole time frame for all of the examples given.\nstart_date = None  # \"0001-01-01\"\nend_date = None  # \"0101-01-01\n\nsave_figs = False\nfig_output_dir = None\n\nlc_kwargs = {}\nserial = False\n\nsfc_variables = []  # ['SSH', 'tos', 'sos']\nmax_frames = None  # 60","visibility":"hide","key":"JRcUsutyOu"},{"type":"outputs","id":"FVXmXSbXIyFdYAn7Nf7BJ","children":[],"visibility":"show","key":"nsB3ukRkaH"}],"visibility":"show","key":"dbjT9RzFI1"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-10-13T13:49:45.352235Z","iopub.status.busy":"2025-10-13T13:49:45.351473Z","iopub.status.idle":"2025-10-13T13:49:45.385236Z","shell.execute_reply":"2025-10-13T13:49:45.384898Z"},"papermill":{"duration":0.037757,"end_time":"2025-10-13T13:49:45.386140","exception":false,"start_time":"2025-10-13T13:49:45.348383","status":"completed"},"tags":["injected-parameters"]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Parameters\ncase_name = \"CROCODILE_tutorial_nwa12_MARBL\"\nCESM_output_dir = (\n    \"/glade/campaign/cgd/oce/projects/CROCODILE/workshops/2025/Diagnostics/CESM_Output/\"\n)\nstart_date = \"\"\nend_date = \"\"\nsave_figs = True\nfig_output_dir = None\nlc_kwargs = {\"threads_per_worker\": 1}\nserial = True\nsfc_variables = [\"SSH\", \"tos\", \"sos\"]\nmax_frames = 60\nsubset_kwargs = {}\nproduct = \"/glade/work/ajanney/crocodile_2025/CUPiD/examples/regional_ocean/computed_notebooks//ocn/Regional_Ocean_Animations.ipynb\"\n","visibility":"show","key":"EtC3lh5lhg"},{"type":"outputs","id":"R2g8WWiKIejXYZTMnaSAl","children":[],"visibility":"show","key":"T4s0mk6986"}],"visibility":"show","key":"TjK2KxqrFB"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-10-13T13:49:45.404047Z","iopub.status.busy":"2025-10-13T13:49:45.403407Z","iopub.status.idle":"2025-10-13T13:49:45.431429Z","shell.execute_reply":"2025-10-13T13:49:45.431124Z"},"papermill":{"duration":0.03194,"end_time":"2025-10-13T13:49:45.432232","exception":false,"start_time":"2025-10-13T13:49:45.400292","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"OUTDIR = f\"{CESM_output_dir}/{case_name}/ocn/hist/\"\nprint(\"Output directory is:\", OUTDIR)","visibility":"hide","key":"I21iRig7Aw"},{"type":"outputs","id":"5YVM8vUWVJDu71HNA9p_a","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Output directory is: /glade/campaign/cgd/oce/projects/CROCODILE/workshops/2025/Diagnostics/CESM_Output//CROCODILE_tutorial_nwa12_MARBL/ocn/hist/\n"},"children":[],"key":"N3OmNNZMBz"}],"visibility":"show","key":"qXyc6yKrSJ"}],"visibility":"show","key":"e3wiqArCkd"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.001542,"end_time":"2025-10-13T13:49:45.435650","exception":false,"start_time":"2025-10-13T13:49:45.434108","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Open sfc_datas and Define Paths","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QTq68nfkAq"}],"identifier":"open-sfc-datas-and-define-paths","label":"Open sfc_datas and Define Paths","html_id":"open-sfc-datas-and-define-paths","implicit":true,"key":"LR03flXBcZ"}],"visibility":"show","key":"tuwDDoxDxE"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-10-13T13:49:45.442106Z","iopub.status.busy":"2025-10-13T13:49:45.441530Z","iopub.status.idle":"2025-10-13T13:49:55.031678Z","shell.execute_reply":"2025-10-13T13:49:55.031388Z"},"papermill":{"duration":9.593983,"end_time":"2025-10-13T13:49:55.032282","exception":false,"start_time":"2025-10-13T13:49:45.438299","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"case_output_dir = os.path.join(CESM_output_dir, case_name, \"ocn\", \"hist\")\n\n# Xarray time decoding things\ntime_coder = xr.coders.CFDatetimeCoder(use_cftime=True)\n\n## Static data includes hgrid, vgrid, bathymetry, land/sea mask\nstatic_data = xr.open_mfdataset(\n    os.path.join(case_output_dir, f\"*static.nc\"),\n    decode_timedelta=True,\n    decode_times=time_coder,\n)\n\n## Surface Data\nsfc_data = xr.open_mfdataset(\n    os.path.join(case_output_dir, f\"*sfc*.nc\"),\n    decode_timedelta=True,\n    decode_times=time_coder,\n)\n\n## Monthly Domain Data\n# monthly_data = xr.open_mfdataset(\n#     os.path.join(case_output_dir, f\"*z*.nc\"),\n#     decode_timedelta=True,\n#     decode_times=time_coder,\n# )\n\n## Image/Gif Output Directory\nif fig_output_dir is None:\n    image_output_dir = os.path.join(\n        \"/glade/derecho/scratch/\",\n        os.environ[\"USER\"],\n        \"archive\",\n        case_name,\n        \"ocn\",\n        \"cupid_images\",\n    )\nelse:\n    image_output_dir = os.path.join(fig_output_dir, case_name, \"ocn\", \"cupid_images\")\nif not os.path.exists(image_output_dir):\n    os.makedirs(image_output_dir)\nprint(\"Image output directory is:\", image_output_dir)","visibility":"hide","key":"n4yedxTcB0"},{"type":"outputs","id":"Z6LCrtuV_tlkQRG0akMzf","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Image output directory is: /glade/derecho/scratch/ajanney/archive/CROCODILE_tutorial_nwa12_MARBL/ocn/cupid_images\n"},"children":[],"key":"OLRLEulmKR"}],"visibility":"show","key":"rIXqSpqe5W"}],"visibility":"show","key":"b64xy7BB9t"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-10-13T13:49:55.041126Z","iopub.status.busy":"2025-10-13T13:49:55.040471Z","iopub.status.idle":"2025-10-13T13:49:55.090522Z","shell.execute_reply":"2025-10-13T13:49:55.090199Z"},"papermill":{"duration":0.054467,"end_time":"2025-10-13T13:49:55.091262","exception":false,"start_time":"2025-10-13T13:49:55.036795","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"## Select for only the variables we want to analyze\nif len(sfc_variables) > 0:\n    print(\"Selecting only the following surface variables:\", sfc_variables)\n    sfc_data = sfc_data[sfc_variables]\n\n## Apply time boundaries\n## if they are the right format\nif len(start_date.split(\"-\")) == 3 and len(end_date.split(\"-\")) == 3:\n    import cftime\n\n    calendar = sfc_data.time.encoding.get(\"calendar\", \"standard\")\n\n    calendar_map = {\n        \"gregorian\": cftime.DatetimeProlepticGregorian,\n        \"noleap\": cftime.DatetimeNoLeap,\n    }\n\n    CFTime = calendar_map.get(calendar, cftime.DatetimeGregorian)\n    y, m, d = [int(i) for i in start_date.split(\"-\")]\n    start_date_time = CFTime(y, m, d)\n    y, m, d = [int(i) for i in end_date.split(\"-\")]\n    end_date_time = CFTime(y, m, d)\n\n    print(\n        f\"Applying time range from start_date: {start_date_time} and end_date: {end_date_time}.\"\n    )\n\n    sfc_data = sfc_data.sel(time=slice(start_date_time, end_date_time))\n\nsfc_time_bounds = [\n    sfc_data[\"time\"].isel(time=0).compute().item(),\n    sfc_data[\"time\"].isel(time=-1).compute().item(),\n]\n\nprint(f\"Surface Data Time Bounds: {sfc_time_bounds[0]} to {sfc_time_bounds[-1]}\")","visibility":"show","key":"KIKWj3fOvw"},{"type":"outputs","id":"pplrAUz_UXU0aL8pZPv3P","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Selecting only the following surface variables: ['SSH', 'tos', 'sos']\nSurface Data Time Bounds: 1999-12-30 12:00:00 to 2000-11-28 12:00:00\n"},"children":[],"key":"uG0PoVl2D6"}],"visibility":"show","key":"Y8hx0KMQno"}],"visibility":"show","key":"y1Pxxf3EVz"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.002612,"end_time":"2025-10-13T13:49:55.097019","exception":false,"start_time":"2025-10-13T13:49:55.094407","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The GIF!","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nD9DMrZvZk"}],"identifier":"the-gif","label":"The GIF!","html_id":"the-gif","implicit":true,"key":"FJwOh2qwqh"}],"visibility":"show","key":"ePUbFPvL6W"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-10-13T13:49:55.102925Z","iopub.status.busy":"2025-10-13T13:49:55.102430Z","iopub.status.idle":"2025-10-13T13:52:05.160706Z","shell.execute_reply":"2025-10-13T13:52:05.160304Z"},"papermill":{"duration":130.061446,"end_time":"2025-10-13T13:52:05.161708","exception":false,"start_time":"2025-10-13T13:49:55.100262","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"if sfc_data[\"time\"].size > max_frames:\n    sfc_data = sfc_data.isel(time=slice(0, max_frames))\n\nfor gif_variable in sfc_variables:\n\n    field = sfc_data[gif_variable]\n\n    coords = utils.chooseGeoCoords(field.dims)\n    areacello = utils.chooseAreacello(field.dims)\n\n    anim = utils.create2DFieldAnimation(\n        field,\n        latitude=static_data[coords[\"latitude\"]],\n        longitude=static_data[coords[\"longitude\"]],\n        iter_dim=\"time\",\n        interval=150,\n        save=save_figs,\n        save_path=image_output_dir,\n    )","visibility":"show","key":"c34vaRmfp6"},{"type":"outputs","id":"Yd2djltIR99ykU1_lNOHR","children":[],"visibility":"show","key":"FVBq9UurT0"}],"visibility":"show","key":"IyPeRCUyqz"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-10-13T13:52:05.172449Z","iopub.status.busy":"2025-10-13T13:52:05.171726Z","iopub.status.idle":"2025-10-13T13:52:41.948544Z","shell.execute_reply":"2025-10-13T13:52:41.948054Z"},"papermill":{"duration":37.10411,"end_time":"2025-10-13T13:52:42.271367","exception":false,"start_time":"2025-10-13T13:52:05.167257","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from matplotlib import rcParams\n\nrcParams[\"animation.embed_limit\"] = (\n    200 * 1024 * 1024\n)  # constrains max size of HTML to be displayed in notebook\n\nHTML(anim.to_jshtml())","visibility":"show","key":"WXeGiQ0uck"},{"type":"outputs","id":"Lu4zfgAwUbJkL2uqsQ6NQ","children":[],"visibility":"show","key":"R84azh9tqM"}],"visibility":"show","key":"GqBaTKK4LK"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Not rendered here!","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"k5EeUKKyqI"}],"identifier":"not-rendered-here","label":"Not rendered here!","html_id":"not-rendered-here","implicit":true,"key":"s1DAS4QCSd"}],"key":"irfCOHfVZt"}],"key":"EUx7o29oBz"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Regional Ocean: Basic Region and Surface Field Visualization","url":"/notebooks/diagnostics/cupid-output/regional-ocean-report-card","group":"Basic CrocoDash Tutorial"},"next":{"title":"Regional Ocean: Atmospheric Forcing","url":"/notebooks/diagnostics/cupid-output/regional-ocean-atmospheric-forcing","group":"Basic CrocoDash Tutorial"}}},"domain":"http://localhost:3000"}